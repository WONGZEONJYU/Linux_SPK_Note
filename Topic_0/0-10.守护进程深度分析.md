# åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æ

## (ä¸€) ä¼šè¯ä¸ç»ˆç«¯çš„å…³è”

### (1) æ€è€ƒ

>â“ä»£ç ä¸­åˆ›å»ºçš„ä¼šè¯ , $\color{red}{å¦‚ä½•å…³è”}$ æ§åˆ¶ç»ˆç«¯?

### (2) æ–°ä¼šè¯å…³è”æ§åˆ¶ç»ˆç«¯çš„æ–¹æ³•

>ä¼šè¯é¦–è¿›ç¨‹æˆåŠŸæ‰“å¼€ç»ˆç«¯è®¾å¤‡ **(è®¾å¤‡æ‰“å¼€å‰å¤„äºç©ºé—²çŠ¶æ€)**
>
>- å…³é—­**æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡º** 
>- å°†`stdin`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDIN_FILENO` **==> 0**
>- å°†`stdout`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDOUT_FILENO` **==> 1**
>- å°†`stderr`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDERR_FILENO` **==> 2**

### (3) ä¸€äº›ç›¸å…³æ¨è®º

>- $\color{red}{æ–°ä¼šè¯ å…³è”}$ **$\color{red}{æ§åˆ¶ç»ˆç«¯}$**  $\color{red}{å,}$  $\color{red}{ä¼šè¯ä¸­çš„}$  **$\color{red}{æ‰€æœ‰è¿›ç¨‹ ç”Ÿå‘½æœŸ}$** $\color{red}{ä¸}$ **$\color{red}{æ§åˆ¶ç»ˆç«¯}$** $\color{red}{ç›¸å…³}$
>- $\color{red}{åªæœ‰}$  **$\color{red}{ä¼šè¯é¦–è¿›ç¨‹}$**  èƒ½å¤Ÿå…³è”æ§åˆ¶ç»ˆç«¯ **(ä¼šè¯ä¸­çš„å…¶å®ƒè¿›ç¨‹ä¸è¡Œ)**
>- è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºå¯ä»¥è¿›è¡Œ é‡å®šå‘
>   - ç”±æè¿°ç¬¦ **0,1,2** å†³å®šé‡å®šå‘çš„ç›®æ ‡ä½ç½® **$\color{red}{(æŒ‰é¡ºåºæ‰“å¼€è®¾å¤‡)}$**
>   - æ§åˆ¶ç»ˆç«¯ä¸è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡º **æ— ç›´æ¥å…³ç³»** 

### (4) ä¸€äº›æƒ³æ³•

><img src="./assets/image-20230801141230475.png" alt="image-20230801141230475" />
>
><img src="./assets/image-20230801141238567.png" alt="image-20230801141238567" />

### (5) ç¼–ç¨‹å®éªŒ : ä¼šè¯ä¸ç»ˆç«¯

>[master.cppå‚è€ƒé“¾æ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/master.cpp)
>
>[session.cppå‚è€ƒé“¾æ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/session.cpp)
>
><img src="./assets/image-20230801141247970.png" alt="image-20230801141247970" />
>
><img src="./assets/image-20230801141255698.png" alt="image-20230801141255698" />
>
><img src="./assets/image-20230801141310562.png" alt="image-20230801141310562" />

## (äºŒ) å®ˆæŠ¤è¿›ç¨‹è¦ç‚¹åˆ†æ

### (1) ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ (Daemon) 

>- å®ˆæŠ¤è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­æ‰§è¡Œä»»åŠ¡çš„ **$\color{red}{åå°è¿›ç¨‹}$**
>   - $\color{red}{ä¸ä¸ä»»ä½•ç»ˆç«¯ç›¸å…³è” (ä¸æ¥æ”¶ç»ˆç«¯ç›¸å…³çš„ä¿¡å·) }$
>   - ç”Ÿå‘½å‘¨æœŸé•¿ , ä¸€æ—¦å¯åŠ¨ , æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šç»ˆæ­¢ (ç›´åˆ°ç³»ç»Ÿé€€å‡º) 
>   - Linuxå¤§å¤šæ•° **$\color{red}{æœåŠ¡å™¨}$** ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹å®ç° (å®ˆæŠ¤è¿›ç¨‹åä»¥ **$\color{red}{åç¼€d}$** ç»“å°¾) 
>

### (2) å®ˆæŠ¤è¿›ç¨‹çš„åˆ›å»ºæ­¥éª¤

>1. é€šè¿‡ `fork()` åˆ›å»ºæ–°è¿›ç¨‹ , æˆåŠŸå , çˆ¶è¿›ç¨‹é€€å‡º
>2. å­è¿›ç¨‹é€šè¿‡ `setsid()` åˆ›å»ºæ–°ä¼šè¯
>3. å­è¿›ç¨‹é€šè¿‡ `fork()` åˆ›å»ºå­™è¿›ç¨‹ (è‚¯å®šä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹) 
>4. å­™è¿›ç¨‹ä¿®æ”¹æ¨¡å¼ `umask()` , æ”¹å˜å·¥ä½œç›®å½•ä¸º `"/"`  **$\color{red}{(æ„ä¹‰ : ä¸å¸Œæœ›å®ˆæŠ¤è¿›ç¨‹ä¸å“ªä¸€ä¸ªç›®å½•ç›¸å…³è” )}$**
>5. **$\color{red}{å…³é—­}$** **æ ‡å‡†è¾“å…¥è¾“å‡º** å’Œ **æ ‡å‡†é”™è¯¯è¾“å‡º**ï¼ˆ`STDIN` ,`STDOUT` ,`STDERR`ï¼‰
>6. **$\color{red}{é‡å®šå‘}$** **æ ‡å‡†è¾“å…¥è¾“å‡º** å’Œ **æ ‡å‡†é”™è¯¯è¾“å‡º** (`"/dev/null"`)
>
>```tex
>â€¼ï¸	â€¼ï¸	â€¼ï¸	åˆ›å»ºå­™è¿›ç¨‹çš„ç›®çš„æ˜¯: å­™è¿›ç¨‹ä¸æ˜¯ ä¼šè¯é¦–è¿›ç¨‹ , æ— æ³•ä¸ç»ˆç«¯ç›¸å…³è” , å­™è¿›ç¨‹æ— æ³•å˜æˆæ§åˆ¶è¿›ç¨‹ï¼Œ
>æˆ‘ä»¬ä¸å¸Œæœ› å®ˆæŠ¤è¿›ç¨‹ ä¸å“ªä¸ªç»ˆç«¯ç›¸å…³è” , ä¸å“ªä¸ªç»ˆç«¯ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ· , æ‰€ä»¥æ‰è®©å­™è¿›ç¨‹å˜æˆå®ˆæŠ¤è¿›ç¨‹
>```

### (3) å®ˆæŠ¤è¿›ç¨‹çš„åˆ›å»ºæ­¥éª¤æµç¨‹å›¾

><img src="./assets/image-20230801141317808.png" alt="image-20230801141317808" />

### (4) å®ˆæŠ¤è¿›ç¨‹å…³é”®ç‚¹åˆ†æ

>- çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ˜¯ä¸ºäº† **åˆ›å»ºæ–°ä¼šè¯**
>- å­è¿›ç¨‹åˆ›å»ºå­™è¿›ç¨‹æ˜¯ä¸ºäº† $\color{red}{é¿å…äº§ç”Ÿ}$ **$\color{red}{æ§åˆ¶è¿›ç¨‹}$**
>- å­™è¿›ç¨‹ä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œå› æ­¤ä¸èƒ½å…³è”ç»ˆç«¯
>- **é‡å®šå‘æ“ä½œ** å¯ä»¥é¿å¼€ **å¥‡æ€ª** çš„è¿›ç¨‹è¾“å‡ºè¡Œä¸º

### (5) ç¼–ç¨‹å®éªŒ : åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹

>[åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/first-d.cpp)
>
><img src="./assets/image-20230801141327172.png" alt="image-20230801141327172" />
>
><img src="./assets/image-20230801141335954.png" alt="image-20230801141335954" />
>
>```tex
>ğŸ˜…æ²¡æœ‰å­™è¿›ç¨‹ä¸­çš„æ‰“å°ä¿¡æ¯ä¸å¤ªåˆç†,å› ä¸ºåœ¨ä¸€äº›æƒ…å†µä¸‹,æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹çš„ä¸€äº›æ‰“å°æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å°†åŸæœ¬é‡å®šå‘åˆ°"/dev/null"çš„è¾“å‡º,é‡æ–°é‡å®šå‘åˆ°å…¶å®ƒæ–‡ä»¶:
>```
>
><img src="./assets/image-20230801141341811.png" alt="image-20230801141341811" />
>
><img src="./assets/image-20230801141348141.png" alt="image-20230801141348141" />
>
>![image-20230801141359739](./assets/image-20230801141359739.png)


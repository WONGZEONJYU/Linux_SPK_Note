# ä¸‰ã€åˆè¯†Linuxè¿›ç¨‹

## ï¼ˆä¸€ï¼‰è¿›ç¨‹ç†è®ºçŠ¶æ€åˆ‡æ¢

### 1.é—®é¢˜ï¼š

> â“straceè¾“å‡ºä¸­å¾—åˆ°`execve(â€¦)`ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ

### 2.è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

> è¿›ç¨‹æ˜¯â€œæ´»â€çš„å®žä½“
>
> <img src="photo/image-20230801134023640.png" alt="image-20230801134023640" />

### 3.Linuxè¿›ç¨‹åŸºæœ¬æ¦‚å¿µ

> * $\color{red}{è¿›ç¨‹}$ æ˜¯Linuxä»»åŠ¡çš„ $\color{red}{æ‰§è¡Œå•å…ƒ}$ï¼Œä¹Ÿæ˜¯Linuxç³»ç»Ÿèµ„æºçš„ $\color{red}{åˆ†é…å•å…ƒ}$
> * æ¯ä¸ªLinuxåº”ç”¨ç¨‹åºè¿è¡ŒåŽç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹æž„æˆ
> * æ¯ä¸ªLinuxè¿›ç¨‹å¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åº
> * Linuxè¿›ç¨‹æœ‰å¤šä¸ª $\color{red}{ä¸åŒçŠ¶æ€}$ ( å³ï¼šLinuxè¿›ç¨‹æœ‰ $\color{red}{ä¸åŒ"æ´»æ³•"}$ )

### 4.Linuxè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

> * $\color{red}{å°±ç»ª/è¿è¡ŒçŠ¶æ€(R)}$ ï¼šTASK_RUNNING
> * $\color{red}{é˜»å¡žçŠ¶æ€}$ï¼š
>   * å¯ä¸­æ–­ï¼ˆS)ï¼šTASK_INTERRUPTIBLE
>   * ä¸å¯ä¸­æ–­ï¼ˆD)ï¼šTASK_UNINTERRUPTIABLE
>   * åŒºåˆ«ï¼šå¯ä¸­æ–­çš„é˜»å¡žçŠ¶æ€å¯ä»¥è¢«å”¤é†’
> * $\color{red}{åœæ­¢çŠ¶æ€ (T)}$ ï¼šTASK_STOPPED
> * $\color{red}{é€€å‡ºçŠ¶æ€}$ ï¼š
>   * åƒµå°¸ï¼ˆX)ï¼šEXIT_ZOMBIEï¼ˆè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œå†…å­˜æ®‹ç•™è¿™ä¸ªè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼‰
>   * æ­»äº¡ï¼ˆZ)ï¼šEXIT_DEAD
>
> <img src="photo/image-20230801134030994.png" alt="image-20230801134030994" />

### 5.Linuxè¿›ç¨‹çŠ¶æ€å‰–æž

><img src="photo/image-20230801134036171.png" alt="image-20230801134036171" />
>
>```
>ðŸ˜…æç¤ºï¼šè¿›ç¨‹çŠ¶æ€è§£é‡Šå¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥ man psåŽ»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
>Here are the different values that the s, stat and state output specifiers (header "STAT" or "S") will display to describe the state of a process:
>D    uninterruptible sleep (usually IO)
>R    running or runnable (on run queue)
>S    interruptible sleep (waiting for an event to complete)
>T    stopped by job control signal
>t    stopped by debugger during the tracing
>W    paging (not valid since the 2.6.xx kernel)
>X    dead (should never be seen)
>Z    defunct ("zombie") process, terminated but not reaped by its parent
>For BSD formats and when the stat keyword is used, additional characters may be displayed:
><    high-priority (not nice to other users)
>N    low-priority (nice to other users)
>L    has pages locked into memory (for real-time and custom IO)
>s    is a session leader
>l    is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)
>+    is in the foreground process group
>
>```
>
>```c++
>/*loop.c / loop.cpp */
>int main(int argc, char const *argv[])
>{
>    while(true);
>    return 0;
>}
>```
>
>[å‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/loop.cpp)
>
><img src="photo/image-20230801134046019.png" alt="image-20230801134046019" />

### 6.Linuxè¿›ç¨‹å¿…ä¼šçŸ¥è¯†

>* æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯† $\color{red}{(è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ŒPID)}$
>* æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ç”±å¦ä¸€è¿›ç¨‹åˆ›å»ºè€Œæ¥ ( å³ : **$\color{red}{çˆ¶è¿›ç¨‹}$** )
>
>```c++
>#include <sys/types.h>
>#include <unistd.h>
>
>pid_t getpid();    /*èŽ·å–å½“å‰è¿›ç¨‹çš„PID*/
>pit_t getppid();    /*èŽ·å–çˆ¶è¿›ç¨‹*/
>
>```
>

### 7. é—®é¢˜

>â“ç¬¬1ä¸ªè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ
>
>â“å¦‚ä½•åˆ›å»ºè¿›ç¨‹ï¼Ÿ

## ï¼ˆäºŒï¼‰Linuxè¿›ç¨‹æ ‘

> * æ•´ä¸ªLinuxç³»ç»Ÿçš„æ‰€æœ‰è¿›ç¨‹æž„æˆä¸€ä¸ªæ ‘çŠ¶ç»“æž„
> * $\color{red}{æ ‘æ ¹ç”±å†…æ ¸è‡ªåŠ¨åˆ›å»ºï¼Œå³:IDLE(PID=0)}$
> * ç³»ç»Ÿä¸­çš„ $\color{red}{ç¬¬1ä¸ªè¿›ç¨‹ æ˜¯ åˆå§‹åŒ–è¿›ç¨‹}$ ( `PID = 1`ï¼Œä¸€äº›Linuxç‰ˆæœ¬å« $\color{red}{init}$ ï¼Œä¸€äº›å« $\color{red}{systemd}$ )
>   * 0å·è¿›ç¨‹åˆ›å»º1å·è¿›ç¨‹ï¼Œ1å·è¿›ç¨‹è´Ÿè´£å®Œæˆå†…æ ¸éƒ¨åˆ†åˆå§‹åŒ–å·¥ä½œ
>   * 1å·è¿›ç¨‹åŠ è½½æ‰§è¡Œåˆå§‹åŒ–ç¨‹åºï¼Œæ¼”å˜ä¸ºç”¨æˆ·æ€1å·è¿›ç¨‹
>
> <img src="photo/image-20230801134054970.png" alt="image-20230801134054970" />
>
> <img src="photo/image-20230801134102215.png" alt="image-20230801134102215" />

## ï¼ˆä¸‰ï¼‰Linuxè¿›ç¨‹åˆ›å»º

> * `pid_t fork(void);` ==> ç³»ç»Ÿè°ƒç”¨
>   * é€šè¿‡å½“å‰è¿›ç¨‹åˆ›å»ºæ–°è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹ä¸ºçˆ¶è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹ä¸ºå­è¿›ç¨‹
> * `int execve(const char *pathname, char *const argv[], char *const encp[]);` ==> ç³»ç»Ÿè°ƒç”¨
>   * åœ¨å½“å‰è¿›ç¨‹ä¸­æ‰§è¡ŒpathnameæŒ‡å®šçš„ç¨‹åºä»£ç 
> * $\color{red}{å…ˆåˆ›å»ºè¿›ç¨‹ï¼Œæ‰èƒ½æ‰§è¡Œç¨‹åºä»£ç }$ðŸ”°

### 1. fork()çš„å·¥ä½œæ–¹å¼

>* ä¸ºå­è¿›ç¨‹ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå¹¶å°†çˆ¶è¿›ç¨‹æ•°æ® $\color{red}{å®Œå…¨å¤åˆ¶}$ åˆ°å­è¿›ç¨‹ç©ºé—´ä¸­
>* ä¸¤ä¸ªè¿›ç¨‹ä¸­çš„ç¨‹åºæ‰§è¡Œä½ç½®å®Œå…¨ä¸€è‡´( `fork()` $\color{red}{å‡½æ•°è°ƒç”¨ä½ç½®}$ )
>* ä¸åŒä¹‹å¤„:
>   * $\color{red}{çˆ¶è¿›ç¨‹:}$ `fork() return child process pid`
>   * $\color{red}{å­è¿›ç¨‹:}$Â `fork() return 0`
>     * é€šè¿‡ `fork()` è¿”å›žå€¼åˆ¤æ–­çˆ¶å­è¿›ç¨‹ï¼Œæ‰§è¡Œä¸åŒä»£ç 
>
><img src="photo/image-20230801134110751.png" alt="image-20230801134110751" />
>
>* å®žä¾‹ : 
>
>â“ä¸‹é¢çš„ç¨‹åºè¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
>
>[å‚è€ƒä»£ç ](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/main.cpp)
>
>```c++
>#include <stdio.h>
>#include <unistd.h>
>
>static int g_global {};
>
>int main(int argc, char const *argv[])
>{
>  printf("Hello World!\n");
>   printf("%d line current = %d!\n",__LINE__,getpid());
>   int pid {};
>   if ((pid = fork()) > 0){
> 
>      g_global = 1;
>       usleep(100);
>       printf("%d line %d g_global = %d\n",__LINE__,getpid(),g_global);
> 
>  }else{
> 
>      g_global = 10;
>       printf("%d line parent = %d!\n",__LINE__,getppid());
>       printf("g_global = %d\n",g_global);
>   }
>   return 0;
> }
>
>/*
>è¿è¡Œç»“æžœï¼š
>Hello World!
>current = 37698!
>parent = 37698!
>g_global = 10
>37698 g_global = 1
>
>çˆ¶è¿›ç¨‹æ‰§è¡Œåˆ°fork()ä¹‹åŽåˆ›å»ºå­è¿›ç¨‹å¹¶è¿”å›žå­è¿›ç¨‹çš„PIDï¼Œæ‰§è¡Œifåˆ†æ”¯ï¼Œçˆ¶è¿›ç¨‹ä¼‘çœ 100us
>åœ¨æ­¤æœŸé—´å­è¿›ç¨‹æ‰§è¡Œï¼Œä»Žforkè¿”å›ž0ï¼Œæ‰§è¡Œelseåˆ†æ”¯
>è¿è¡Œç»“æžœçœ‹èµ·æ¥å°±æ˜¯å…ˆæ‰§è¡Œelseåˆ†æ”¯å†æ‰§è¡Œifåˆ†æ”¯ 
>*/   
>```
>
><img src="photo/image-20230801134128434.png" alt="image-20230801134128434" />
>
><img src="photo/image-20230801134135372.png" alt="image-20230801134135372" />

### 2. æ€è€ƒ

> â“å¦‚ä½•ç†è§£â€œæ¯ä¸ªLinuxè¿›ç¨‹å¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºâ€ï¼Ÿ
>
><img src="photo/image-20230801134142157.png" alt="image-20230801134142157" />

### 3. `execve(...)`çš„å·¥ä½œæ–¹å¼

>```c++
>int execve(const char *pathname, char *const argv[], char *const encp[]);
>```
>
>* æ ¹æ®å‚æ•°è·¯å¾„ $\color{red}{pathname}$ åŠ è½½å¯æ‰§è¡Œç¨‹åº ==> åŠ è½½åˆ°å½“å‰è¿›ç¨‹ä¸­
>* é€šè¿‡å¯æ‰§è¡Œç¨‹åºä¿¡æ¯æž„å»ºè¿›ç¨‹æ•°æ®ï¼Œå¹¶å†™å…¥å½“å‰è¿›ç¨‹ç©ºé—´
>* å°†ç¨‹åºæ‰§è¡Œä½ç½®é‡ç½®åˆ°å…¥å£åœ°å€å¤„ (å³: `main()` )
>* `execve()`å°† $\color{red}{é‡ç½®å½“å‰è¿›ç¨‹ç©ºé—´(ä»£ç  and æ•°æ®)è€Œä¸ä¼šåˆ›å»ºæ–°è¿›ç¨‹}$

### 4. é—®é¢˜

>â“ä¸‹é¢çš„ç¨‹åºè¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
>
>[test0.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/test0.cpp)
>
>[helloworld.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/helloworld.cpp)
>
><img src="photo/image-20230801134152230.png" alt="image-20230801134152230" />
>
><img src="photo/image-20230801134158551.png" alt="image-20230801134158551" />
>
>- `fork()`ä¸Ž`execve()`ç»“åˆä½¿ç”¨åˆ›å»ºæ–°è¿›ç¨‹ï¼š
>
>[test.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/test.cpp)
>
>[helloworld.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/2.Process/helloworld.cpp)
>
><img src="photo/image-20230801134205532.png" alt="image-20230801134205532" />
>
>![image-20230801134214508](photo/image-20230801134214508.png)


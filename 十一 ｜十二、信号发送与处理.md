# åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†

## (ä¸€) ä¿¡å·çš„æ¦‚å¿µåŠåˆ†ç±»

### 1. é—®é¢˜

>â“æŒ‰ä¸‹ ctrl+c åŽ , å‘½ä»¤è¡Œçš„å‰å°è¿›ç¨‹ä¼šè¢«ç»ˆæ­¢ , why?

### 2. ä»€ä¹ˆæ˜¯ä¿¡å·

>- ä¿¡å·æ˜¯ä¸€ç§ **$\color{red}{"è½¯ä»¶ä¸­æ–­"}$** , ç”¨æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶
>   - å†…æ ¸å‘é€ä¿¡å·åˆ°æŸä¸ªè¿›ç¨‹ , é€šçŸ¥è¿›ç¨‹äº‹ä»¶çš„å‘ç”Ÿ
>   - äº‹ä»¶å¯èƒ½æ¥è‡ªç¡¬ä»¶ , å¯èƒ½æ¥è‡ªç”¨æˆ·è¾“å…¥ , å¯èƒ½æ¥è‡ªç¨‹åºè‡ªèº«é”™è¯¯ (å¦‚é™¤é›¶é”™è¯¯ç­‰)
>
> - ä¿¡å·æ˜¯ä¸€ç§ç±»åž‹çš„ $\color{red}{è¿›ç¨‹é—´é€šä¿¡æ–¹å¼}$ ( **$\color{red}{ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¿¡å·}$** )
>   - Aè¿›ç¨‹å‘ç”Ÿäº‹ä»¶T , å‘Bè¿›ç¨‹å‘é€ä¿¡å· , Bè¿›ç¨‹æ‰§è¡ŒåŠ¨ä½œå“åº”äº‹ä»¶
>   - è¿›ç¨‹å¯ä»¥å¯¹æŽ¥æ”¶åˆ°çš„ $\color{red}{ä¸åŒä¿¡å·}$ è¿›è¡Œ $\color{red}{ä¸åŒåŠ¨ä½œå“åº”}$ (ä¿¡å· , å¤„ç†)
>

### 3. ä¿¡å·çš„åˆ†ç±»

>- ç¡¬ä»¶å¼‚å¸¸
>   - å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶é”™è¯¯ , å‘é€ç›¸åº”ä¿¡å·ç»™ç›¸å…³è¿›ç¨‹
>- ç»ˆç«¯ä¿¡å· (ç”¨æˆ·äº¤äº’ä¿¡å·)
>   - åœ¨ç»ˆç«¯è¾“å…¥â€œç‰¹æ®Šå­—ç¬¦â€ç­‰ä»·äºŽå‘å‰å°è¿›ç¨‹ç»„å‘é€ç›¸åº”çš„ä¿¡å·
>- è½¯ä»¶ä¿¡å·
>   - åœ¨è½¯ä»¶å±‚é¢ (è¿›ç¨‹ä»£ç ä¸­) è§¦å‘çš„ä¿¡å· (å‘é€ç»™è‡ªèº«æˆ–å…¶å®ƒè¿›ç¨‹)
>

#### (1) ç¡¬ä»¶å¼‚å¸¸ä¿¡å·

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134116113.png" alt="image-20230724134116113" />

(2) ç»ˆç«¯ç›¸å…³ä¿¡å·

>- `SIGINT` ( `ctrl + c` )
>   - ç¨‹åºç»ˆæ­¢ä¿¡å·ï¼Œç”¨äºŽé€šçŸ¥å‰å°è¿›ç¨‹ç»„ç»ˆæ­¢è¿›ç¨‹
>- `SIGQUIT` ( `ctrl + \` )
>   - ä¸Ž`SIGINT`ç±»ä¼¼ï¼Œè¿›ç¨‹æ”¶åˆ°è¯¥ä¿¡å·é€€å‡ºæ—¶å¯äº§ç”Ÿ coredump æ–‡ä»¶
>- `SIGTSTP`( `ctrl + z` )
>   - åœæ­¢è¿›ç¨‹çš„è¿è¡Œ , è¿›ç¨‹æ”¶åˆ°è¯¥ä¿¡å·åŽå¯ä»¥é€‰æ‹©å¤„ç†å’Œå¿½ç•¥
>   - è¿›ç¨‹æ”¶åˆ°è¯¥ä¿¡å·åŽåœæ­¢è¿è¡Œ (çŠ¶æ€å‘ç”Ÿè½¬æ¢) , åŽç»­å¯æ¢å¤è¿è¡ŒçŠ¶æ€

#### (3) è½¯ä»¶ç›¸å…³ä¿¡å·

>- å­è¿›ç¨‹é€€å‡º : çˆ¶è¿›ç¨‹æ”¶åˆ°`SIGCHLD`ä¿¡å·
>- çˆ¶è¿›ç¨‹é€€å‡º : å­è¿›ç¨‹å¯èƒ½æ”¶åˆ°ä¿¡å· ( ä»€ä¹ˆä¿¡å·? )
>- å®šæ—¶å™¨åˆ°æœŸ : `alarm()` , `ualarm()` , `timer_create()` , â€¦â€¦
>- ä¸»åŠ¨å‘é€ä¿¡å· : `kill()` , `raise()` , â€¦â€¦
>- â€¦â€¦

### 4. å†…æ ¸ä¸Žä¿¡å·

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134602656.png" alt="image-20230724134602656" />

### 5. System V  vs  BSD

>- System Vï¼šä¹Ÿè¢«ç§°ä¸º AT&T SystemVï¼Œæ˜¯Unixæ“ä½œç³»ç»Ÿä¼—å¤šç‰ˆæœ¬ä¸­çš„ä¸€æ”¯
>- BSDï¼šåŠ å·žå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å¼€åˆ›ï¼ŒUnixè¡ç”Ÿç³»ç»Ÿï¼Œä»£è¡¨ç”±æ­¤æ´¾ç”Ÿå‡ºçš„å„ç§å¥—ä»¶ç»„åˆ
>
>```
>ðŸ“– Linuxä¹‹æ‰€ä»¥è¢«ç§°ä¸ºç±»Unixæ“ä½œç³»ç»Ÿ,éƒ¨åˆ†åŽŸå› å°±æ˜¯Linuxçš„æ“ä½œé£Žæ ¼æ˜¯ä»‹äºŽä¸Šè¿°äºŒè€…ä¹‹é—´,ä¸”ä¸åŒåŽ‚å•†ä¸ºäº†ç…§é¡¾ä¸åŒçš„ç”¨æˆ·,å…¶å‘è¡Œç‰ˆæœ¬çš„æ“ä½œé£Žæ ¼å­˜åœ¨å·®å¼‚
>```
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134745523.png" alt="image-20230724134745523" />

## (äºŒ) ä¿¡å·å‘é€ä¸Žå¤„ç†

### 1. ä¿¡å·å¤„ç†

#### (1) ä¿¡å·çš„é»˜è®¤å¤„ç†

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134843703.png" alt="image-20230724134843703" />

#### (2) è‡ªå®šä¹‰ä¿¡å·å¤„ç†

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134902389.png" alt="image-20230724134902389" />
>
>```c++
>#include <sys/types.h>
>#include <signal.h>
>typedef void(*sighandler_t)(int);
>sighandler_t signal(int signum, sighandler_t handler);
>sighandler_t sysv_signal(int signum, sighandler_t handler);
>sighandler_t bsd_signal(int signum, sighandler_t handler);
>```

#### (3) ä¿¡å·å¤„ç†ç¤ºä¾‹

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724134954717.png" alt="image-20230724134954717" />

### 2. ä¿¡å·å‘é€

#### (1) è‡ªå®šä¹‰ä¿¡å·å‘é€

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135036046.png" alt="image-20230724135036046" />
>
>```c++
>#include <sys/types.h>
>#include <signal.h>
>int kill(pid_t pid, int sig); 
>int raise(int sig); // ä¿¡å·å¤„ç†å®Œæ¯•åŽè¿”å›ž (ä¿¡å·å¤„ç†å‡½æ•°çš„æ¯ä¸€æ®µä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åŽæ‰è¿”å›ž)
>```
>
>```
>ðŸ“–
>æ ‡å‡†ä¿¡å·æ˜¯Unixç³»ç»Ÿä¸­çš„ä¿¡å·,ç¼–å·èŒƒå›´ä»Ž1åˆ°31
>å®žæ—¶ä¿¡å·æ˜¯Linuxç‹¬æœ‰çš„ä¿¡å·,ç¼–å·èŒƒå›´ä»Ž32åˆ°64
>```
>
>- `kill(...)` å’Œ `raise(...)` æ˜¯ç”¨æ¥å‘é€ä¿¡å·çš„ : 
>   - `raise(...)` æŠŠä¿¡å·å‘é€ç»™ **(è¿›ç¨‹)** è‡ªèº«
>   - `kill(...)` æŠŠä¿¡å·å‘é€ç»™ **è¿›ç¨‹** æˆ– **è¿›ç¨‹ç»„**
>    - `pid > 0` , å°†ä¿¡å·ä¼ ç»™è¿›ç¨‹è¯†åˆ«ç ä¸ºpid çš„è¿›ç¨‹
>    - `pid == 0` , å°†ä¿¡å·ä¼ ç»™å’Œç›®å‰è¿›ç¨‹ç›¸åŒè¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹ ($\color{red}{å½“å‰è¿›ç¨‹ç»„ä¸‹çš„æ‰€æœ‰è¿›ç¨‹}$ éƒ½ä¼šæ”¶åˆ°ä¿¡å·)
>    - `pid == -1` , å°†ä¿¡å· **$\color{red}{å¹¿æ’­}$** ä¼ é€ç»™ç³»ç»Ÿå†…æ‰€æœ‰çš„è¿›ç¨‹
>    - `pid < 0` , å°†ä¿¡å·ä¼ ç»™ è¿›ç¨‹ç»„è¯†åˆ«ç  ä¸º pidç»å¯¹å€¼ çš„æ‰€æœ‰è¿›ç¨‹

#### (2) ä¿¡å·å‘é€ç¤ºä¾‹

><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135456467.png" alt="image-20230724135456467" />

#### (3) ç¼–ç¨‹å®žéªŒ : ä¿¡å·å‘é€ä¸Žå¤„ç†

>[ä¿¡å·å‘é€ä¸Žå¤„ç†main.cppå‚è€ƒä»£ç ](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/10.Signal/11/main.cpp)
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135548971.png" alt="image-20230724135548971" />
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135554672.png" alt="image-20230724135554672" />
>
>[main.cpp test.cppå‚è€ƒä»£ç ](https://github.com/WONGZEONJYU/Linux_System_Program/tree/main/10.Signal/11)
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135752977.png" alt="image-20230724135752977" />
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724135800125.png" alt="image-20230724135800125" />

### (ä¸‰) ä¿¡å·å¤„ç†ä¸‰å¤§ç‰¹æ€§

#### 1. é—®é¢˜

>â“ä¸‰ç§æ³¨å†Œä¿¡å·ä¸Žå¤„ç†å‡½æ•°çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«?

#### 2. ä¿¡å·çš„OneShot æ€§

>- System Vé£Žæ ¼çš„signalå‡½æ•° , æ³¨å†Œçš„ $\color{red}{ä¿¡å·å¤„ç†æ˜¯}$ **$\color{red}{ä¸€æ¬¡æ€§çš„}$**
>   - è¿›ç¨‹æ”¶åˆ°ä¿¡å·åŽ , è°ƒç”¨ç”±signalæ³¨å†Œçš„å¤„ç†å‡½æ•°
>   - å¤„ç†å‡½æ•°ä¸€æ—¦æ‰§è¡Œä¹‹åŽ , è¿›ç¨‹é€šè¿‡é»˜è®¤çš„æ–¹å¼å¤„ç†åŽç»­ç›¸åŒä¿¡å·
>- å¦‚æžœæƒ³è¦é‡å¤è§¦å‘ , é‚£ä¹ˆå¿…é¡»å†æ¬¡è°ƒç”¨ sys_vé£Žæ ¼ çš„`signal(...)` (`sysv_signal(...)`) æ³¨å†Œå¤„ç†å‡½æ•°
>- BSDé£Žæ ¼çš„signalå‡½æ•°ä¸å­˜åœ¨ OneShot , èƒ½å¤Ÿè‡ªåŠ¨åå¤è§¦å‘å¤„ç†å‡½æ•°çš„è°ƒç”¨
>- é»˜è®¤çš„signalå‡½æ•°å’ŒBSDé£Žæ ¼çš„signalå‡½æ•°ä¸€è‡´
>

#### 3. ä¿¡å·çš„è‡ªèº«å±è”½ç‰¹æ€§

>- åœ¨ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡ŒæœŸé—´ (è¿˜æœªå¤„ç†ç»“æŸ) , $\color{red}{å¾ˆå¯èƒ½å†æ¬¡æ”¶åˆ°å½“å‰ä¿¡å· (ç›¸åŒä¿¡å·)}$
>   - å³ : å¤„ç† A ä¿¡å·çš„æ—¶å€™ , å†æ¬¡æ”¶åˆ° A ä¿¡å·
>- å¯¹äºŽ System V é£Žæ ¼çš„ signal å‡½æ•° , $\color{red}{ä¼šå¼•èµ·ä¿¡å·å¤„ç†å‡½æ•°çš„é‡å…¥}$
>   - å³ : è°ƒç”¨å¤„ç†å‡½æ•°çš„è¿‡ç¨‹ä¸­ , å†æ¬¡æ”¶åˆ°åŒä¸ªä¿¡å·è§¦å‘ä¿¡å·å¤„ç†å‡½æ•°çš„è°ƒç”¨
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724140701032.png" alt="image-20230724140701032" />
>
>```
>â“æ€è€ƒ:BSDé£Žæ ¼çš„signalå‡½æ•°,å¤„ç†Aä¿¡å·æœŸé—´,å¦‚æžœæ”¶åˆ°Bä¿¡å·ä¼šå‘ç”Ÿä»€ä¹ˆ?
>```

#### 4.ç³»ç»Ÿè°ƒç”¨é‡å¯ç‰¹æ€§

>- ç³»ç»Ÿè°ƒç”¨æœŸé—´ , å¯èƒ½æ”¶åˆ°ä¿¡å· , $\color{red}{æ­¤æ—¶è¿›ç¨‹ å¿…é¡» ä»Žç³»ç»Ÿè°ƒç”¨ä¸­ è¿”å›ž}$ 
>- å¯¹äºŽæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿè°ƒç”¨ ( `write()` / `read()` ) , è¢«ä¿¡å·ä¸­æ–­çš„å¯èƒ½æ€§å¾ˆå¤§
>   - å¦‚æžœå¸Œæœ›ä¿¡å·å¤„ç†ä¹‹åŽ , è¢«ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨èƒ½å¤Ÿé‡å¯ , åˆ™ : 
>     - å¯ä»¥é€šè¿‡æ¡ä»¶ `errno == EINTR` åˆ¤æ–­æ‰‹åŠ¨é‡å¯ç³»ç»Ÿè°ƒç”¨
>
>- ç³»ç»Ÿè°ƒç”¨é‡å¯ç¤ºä¾‹ä»£ç  ( `wait()` ) :
>
><img src="åä¸€ ï½œåäºŒã€ä¿¡å·å‘é€ä¸Žå¤„ç†.assets/image-20230724141935773.png" alt="image-20230724141935773" />
>
>- ç³»ç»Ÿè°ƒç”¨é‡å¯ç‰¹æ€§ : 
>   - System V é£Žæ ¼çš„ signal() å‡½æ•° : ( æ‰‹å·¥é‡å¯ )
>     - ç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­åŽ , ç›´æŽ¥è¿”å›ž -1 , å¹¶ä¸” `errno == EINTR`
>
>   - BSD é£Žæ ¼çš„ signal() å‡½æ•° : ( è‡ªåŠ¨é‡å¯ )
>     - ç³»ç»Ÿè°ƒç”¨è¢«ä¸­æ–­ , å†…æ ¸åœ¨ä¿¡å·å¤„ç†å‡½æ•°ç»“æŸåŽ , è‡ªåŠ¨é‡å¯ç³»ç»Ÿè°ƒç”¨
>






# åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž

## (ä¸€) ä¼šè¯ä¸Žç»ˆç«¯çš„å…³è”

### (1) æ€è€ƒ

>â“ä»£ç ä¸­åˆ›å»ºçš„ä¼šè¯ , $\color{red}{å¦‚ä½•å…³è”}$ æŽ§åˆ¶ç»ˆç«¯?

### (2) æ–°ä¼šè¯å…³è”æŽ§åˆ¶ç»ˆç«¯çš„æ–¹æ³•

>ä¼šè¯é¦–è¿›ç¨‹æˆåŠŸæ‰“å¼€ç»ˆç«¯è®¾å¤‡ **(è®¾å¤‡æ‰“å¼€å‰å¤„äºŽç©ºé—²çŠ¶æ€)**
>
>- å…³é—­**æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡º** 
>- å°†`stdin`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDIN_FILENO` **==> 0**
>- å°†`stdout`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDOUT_FILENO` **==> 1**
>- å°†`stderr`å…³è”åˆ°ç»ˆç«¯è®¾å¤‡ : `STDERR_FILENO` **==> 2**

### (3) ä¸€äº›ç›¸å…³æŽ¨è®º

>- $\color{red}{æ–°ä¼šè¯ å…³è”}$ **$\color{red}{æŽ§åˆ¶ç»ˆç«¯}$**  $\color{red}{åŽ,}$  $\color{red}{ä¼šè¯ä¸­çš„}$  **$\color{red}{æ‰€æœ‰è¿›ç¨‹ ç”Ÿå‘½æœŸ}$** $\color{red}{ä¸Ž}$ **$\color{red}{æŽ§åˆ¶ç»ˆç«¯}$** $\color{red}{ç›¸å…³}$
>- $\color{red}{åªæœ‰}$  **$\color{red}{ä¼šè¯é¦–è¿›ç¨‹}$**  èƒ½å¤Ÿå…³è”æŽ§åˆ¶ç»ˆç«¯ **(ä¼šè¯ä¸­çš„å…¶å®ƒè¿›ç¨‹ä¸è¡Œ)**
>- è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºä¸Žæ ‡å‡†é”™è¯¯è¾“å‡ºå¯ä»¥è¿›è¡Œ é‡å®šå‘
>   - ç”±æè¿°ç¬¦ **0,1,2** å†³å®šé‡å®šå‘çš„ç›®æ ‡ä½ç½® **$\color{red}{(æŒ‰é¡ºåºæ‰“å¼€è®¾å¤‡)}$**
>   - æŽ§åˆ¶ç»ˆç«¯ä¸Žè¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡º **æ— ç›´æŽ¥å…³ç³»** 

### (4) ä¸€äº›æƒ³æ³•

><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724110550732.png" alt="image-20230724110550732" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724110558300.png" alt="image-20230724110558300" />

### (5) ç¼–ç¨‹å®žéªŒ : ä¼šè¯ä¸Žç»ˆç«¯

>[master.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/master.cpp)
>
>[session.cppå‚è€ƒé“¾æŽ¥](https://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/session.cpp)
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724110706751.png" alt="image-20230724110706751" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724110715187.png" alt="image-20230724110715187" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724110722601.png" alt="image-20230724110722601" />

## (äºŒ) å®ˆæŠ¤è¿›ç¨‹è¦ç‚¹åˆ†æž

### (1) ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ (Daemon) 

>- å®ˆæŠ¤è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­æ‰§è¡Œä»»åŠ¡çš„ **$\color{red}{åŽå°è¿›ç¨‹}$**
>   - $\color{red}{ä¸ä¸Žä»»ä½•ç»ˆç«¯ç›¸å…³è” (ä¸æŽ¥æ”¶ç»ˆç«¯ç›¸å…³çš„ä¿¡å·) }$
>   - ç”Ÿå‘½å‘¨æœŸé•¿ , ä¸€æ—¦å¯åŠ¨ , æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šç»ˆæ­¢ (ç›´åˆ°ç³»ç»Ÿé€€å‡º) 
>   - Linuxå¤§å¤šæ•° **$\color{red}{æœåŠ¡å™¨}$** ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹å®žçŽ° (å®ˆæŠ¤è¿›ç¨‹åä»¥ **$\color{red}{åŽç¼€d}$** ç»“å°¾) 
>

### (2) å®ˆæŠ¤è¿›ç¨‹çš„åˆ›å»ºæ­¥éª¤

>1. é€šè¿‡ `fork()` åˆ›å»ºæ–°è¿›ç¨‹ , æˆåŠŸåŽ , çˆ¶è¿›ç¨‹é€€å‡º
>2. å­è¿›ç¨‹é€šè¿‡ `setsid()` åˆ›å»ºæ–°ä¼šè¯
>3. å­è¿›ç¨‹é€šè¿‡ `fork()` åˆ›å»ºå­™è¿›ç¨‹ (è‚¯å®šä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹) 
>4. å­™è¿›ç¨‹ä¿®æ”¹æ¨¡å¼ `umask()` , æ”¹å˜å·¥ä½œç›®å½•ä¸º `"/"`  **$\color{red}{(æ„ä¹‰ : ä¸å¸Œæœ›å®ˆæŠ¤è¿›ç¨‹ä¸Žå“ªä¸€ä¸ªç›®å½•ç›¸å…³è” )}$**
>5. **$\color{red}{å…³é—­}$** **æ ‡å‡†è¾“å…¥è¾“å‡º** å’Œ **æ ‡å‡†é”™è¯¯è¾“å‡º**ï¼ˆ`STDIN` ,`STDOUT` ,`STDERR`ï¼‰
>6. **$\color{red}{é‡å®šå‘}$** **æ ‡å‡†è¾“å…¥è¾“å‡º** å’Œ **æ ‡å‡†é”™è¯¯è¾“å‡º** (`"/dev/null"`)
>
>```tex
>â€¼ï¸	â€¼ï¸	â€¼ï¸	åˆ›å»ºå­™è¿›ç¨‹çš„ç›®çš„æ˜¯: å­™è¿›ç¨‹ä¸æ˜¯ ä¼šè¯é¦–è¿›ç¨‹ , æ— æ³•ä¸Žç»ˆç«¯ç›¸å…³è” , å­™è¿›ç¨‹æ— æ³•å˜æˆæŽ§åˆ¶è¿›ç¨‹ï¼Œ
>æˆ‘ä»¬ä¸å¸Œæœ› å®ˆæŠ¤è¿›ç¨‹ ä¸Žå“ªä¸ªç»ˆç«¯ç›¸å…³è” , ä¸Žå“ªä¸ªç»ˆç«¯ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ· , æ‰€ä»¥æ‰è®©å­™è¿›ç¨‹å˜æˆå®ˆæŠ¤è¿›ç¨‹
>```

### (3) å®ˆæŠ¤è¿›ç¨‹çš„åˆ›å»ºæ­¥éª¤æµç¨‹å›¾

><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724112359768.png" alt="image-20230724112359768" />

### (4) å®ˆæŠ¤è¿›ç¨‹å…³é”®ç‚¹åˆ†æž

>- çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ˜¯ä¸ºäº† **åˆ›å»ºæ–°ä¼šè¯**
>- å­è¿›ç¨‹åˆ›å»ºå­™è¿›ç¨‹æ˜¯ä¸ºäº† $\color{red}{é¿å…äº§ç”Ÿ}$ **$\color{red}{æŽ§åˆ¶è¿›ç¨‹}$**
>- å­™è¿›ç¨‹ä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œå› æ­¤ä¸èƒ½å…³è”ç»ˆç«¯
>- **é‡å®šå‘æ“ä½œ** å¯ä»¥é¿å¼€ **å¥‡æ€ª** çš„è¿›ç¨‹è¾“å‡ºè¡Œä¸º

### (5) ç¼–ç¨‹å®žéªŒ : åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹

>[åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹](ä»£ç å‚è€ƒé“¾æŽ¥ï¼šhttps://github.com/WONGZEONJYU/Linux_System_Program/blob/main/9.daemon_process/first-d.cpp)
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724112743427.png" alt="image-20230724112743427" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724112753437.png" alt="image-20230724112753437" />
>
>```tex
>ðŸ˜…æ²¡æœ‰å­™è¿›ç¨‹ä¸­çš„æ‰“å°ä¿¡æ¯ä¸å¤ªåˆç†,å› ä¸ºåœ¨ä¸€äº›æƒ…å†µä¸‹,æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹çš„ä¸€äº›æ‰“å°æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å°†åŽŸæœ¬é‡å®šå‘åˆ°"/dev/null"çš„è¾“å‡º,é‡æ–°é‡å®šå‘åˆ°å…¶å®ƒæ–‡ä»¶:
>```
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724113106194.png" alt="image-20230724113106194" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724113114271.png" alt="image-20230724113114271" />
>
><img src="åã€å®ˆæŠ¤è¿›ç¨‹æ·±åº¦åˆ†æž.assets/image-20230724113120498.png" alt="image-20230724113120498" />

